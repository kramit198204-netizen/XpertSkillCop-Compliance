<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XpertCopTec - Compliance Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ==================== CSS - ALL STYLES ==================== */
        :root {
            --primary-blue: #2563eb;
            --secondary-green: #10b981;
            --light-bg: #f8fafc;
            --dark-text: #1e293b;
            --accent-amber: #f59e0b;
            --white: #ffffff;
            --gray-light: #e2e8f0;
            --gray-dark: #64748b;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark-text);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ==================== LOGIN PAGE ==================== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .brand-header {
            background: var(--white);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .logo-img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid var(--gray-light);
            padding: 5px;
            background: white;
        }

        .company-name-display {
            color: var(--primary-blue);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .company-tagline {
            color: var(--secondary-green);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .tagline {
            color: var(--gray-dark);
            font-size: 14px;
            margin-bottom: 30px;
        }

        .login-form {
            margin-top: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-green));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }

        .login-error {
            color: var(--danger);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }

        /* ==================== DASHBOARD ==================== */
        .header {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-small {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid var(--gray-light);
            padding: 3px;
            background: white;
        }

        .brand-info h2 {
            color: var(--primary-blue);
            font-size: 20px;
        }

        .brand-info p {
            color: var(--gray-dark);
            font-size: 12px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-details span {
            font-weight: 600;
        }

        .user-details small {
            color: var(--gray-dark);
            font-size: 12px;
        }

        .btn-logout {
            padding: 8px 20px;
            background: var(--light-bg);
            border: 2px solid var(--gray-light);
            border-radius: 6px;
            color: var(--gray-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        /* ==================== NAVIGATION ==================== */
        .navigation {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            border-bottom: 1px solid var(--gray-light);
        }

        .nav-btn {
            padding: 10px 20px;
            background: var(--light-bg);
            border: none;
            border-radius: 8px;
            color: var(--gray-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: var(--primary-blue);
            color: white;
        }

        .nav-btn.active {
            background: var(--primary-blue);
            color: white;
            font-weight: 600;
        }

        /* ==================== MAIN CONTENT ==================== */
        .main-content {
            padding: 30px;
            min-height: calc(100vh - 150px);
            background: var(--light-bg);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* ==================== STATS CARDS ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: var(--white);
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            border-left: 5px solid;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.blue { border-color: var(--primary-blue); }
        .stat-card.green { border-color: var(--success); }
        .stat-card.orange { border-color: var(--warning); }
        .stat-card.red { border-color: var(--danger); }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .blue .stat-icon { background: var(--primary-blue); }
        .green .stat-icon { background: var(--success); }
        .orange .stat-icon { background: var(--warning); }
        .red .stat-icon { background: var(--danger); }

        .stat-info h3 {
            font-size: 14px;
            color: var(--gray-dark);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark-text);
        }

        /* ==================== TABLES ==================== */
        .table-container {
            background: var(--white);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin: 20px 0;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: var(--light-bg);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark-text);
            border-bottom: 2px solid var(--gray-light);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .data-table tr:hover {
            background: var(--light-bg);
        }

        /* ==================== BUTTONS ==================== */
        .btn-secondary {
            padding: 10px 20px;
            background: var(--white);
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            color: var(--gray-dark);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .btn-export {
            padding: 10px 20px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn {
            padding: 10px 20px;
            background: var(--white);
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            color: var(--dark-text);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
        }

        .action-btn:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        /* ==================== FORMS ==================== */
        .form-container {
            background: var(--white);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            max-width: 800px;
            margin: 0 auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row > div {
            flex: 1;
        }

        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 100px;
        }

        .upload-area {
            border: 2px dashed var(--gray-light);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: var(--primary-blue);
            background: var(--light-bg);
        }

        .upload-area i {
            font-size: 48px;
            color: var(--gray-light);
            margin-bottom: 15px;
        }

        .file-info {
            font-size: 12px;
            color: var(--gray-dark);
            margin-top: 5px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        /* ==================== FILTERS ==================== */
        .filters {
            background: var(--white);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filters select,
        .filters input {
            padding: 10px 15px;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            min-width: 150px;
        }

        /* ==================== MODAL ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--white);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px;
            background: var(--primary-blue);
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
        }

        /* ==================== CHAT MESSAGES ==================== */
        #chatMessages {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
        }

        .bot-message {
            display: flex;
            justify-content: flex-start;
            margin: 10px 0;
        }

        .user-message {
            display: flex;
            justify-content: flex-end;
            margin: 10px 0;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .bot-message .message-bubble {
            background: var(--light-bg);
            color: var(--dark-text);
            border-bottom-left-radius: 5px;
        }

        .user-message .message-bubble {
            background: var(--primary-blue);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--gray-light);
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--gray-light);
            border-radius: 25px;
            outline: none;
        }

        .chat-input button {
            width: 50px;
            height: 50px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }

        /* ==================== ALERTS ==================== */
        #alertContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
        }

        .alert.success { background: var(--success); }
        .alert.error { background: var(--danger); }
        .alert.warning { background: var(--warning); }
        .alert.info { background: var(--info); }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ==================== STATUS BADGES ==================== */
        .status-active { color: var(--success); font-weight: 600; }
        .status-expiring-soon { color: var(--warning); font-weight: 600; }
        .status-expired { color: var(--danger); font-weight: 600; }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.active { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .status-badge.warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .status-badge.expired { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .navigation {
                overflow-x: auto;
                padding: 10px;
            }
            
            .nav-btn {
                padding: 8px 15px;
                font-size: 14px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filters select,
            .filters input {
                width: 100%;
            }
            
            .modal.active {
                padding: 10px;
            }
            
            .modal-content {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .brand-header {
                padding: 30px 20px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .form-container {
                padding: 20px;
            }
        }

        /* ==================== SUBSCRIPTION PLANS ==================== */
        .subscription-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .plan-card {
            background: var(--white);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid var(--gray-light);
            transition: all 0.3s;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .plan-card.featured {
            border-color: var(--primary-blue);
            transform: scale(1.05);
        }

        .plan-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-blue);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .plan-price {
            font-size: 36px;
            font-weight: 700;
            color: var(--dark-text);
            margin: 20px 0;
        }

        .plan-price span {
            font-size: 14px;
            color: var(--gray-dark);
        }

        .plan-features {
            list-style: none;
            margin: 20px 0;
            text-align: left;
        }

        .plan-features li {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .plan-features i {
            color: var(--success);
        }

        /* ==================== PAYMENT MODAL ==================== */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .payment-method {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method:hover {
            border-color: var(--primary-blue);
            background: var(--light-bg);
        }

        .payment-method.selected {
            border-color: var(--primary-blue);
            background: rgba(37, 99, 235, 0.1);
        }

        .payment-method i {
            font-size: 24px;
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }

        .qr-code-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: var(--light-bg);
            border-radius: 10px;
        }

        .qr-code-placeholder {
            width: 200px;
            height: 200px;
            background: white;
            border: 2px dashed var(--gray-light);
            border-radius: 10px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-dark);
            font-size: 14px;
        }

        .bank-details {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .bank-details h4 {
            margin-bottom: 15px;
            color: var(--dark-text);
        }

        .bank-details p {
            margin: 8px 0;
            font-size: 14px;
        }

        /* ==================== SETTINGS ==================== */
        .settings-container {
            background: var(--white);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section h3 {
            color: var(--dark-text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-upload-area {
            border: 2px dashed var(--gray-light);
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .logo-preview {
            width: 150px;
            height: 150px;
            object-fit: contain;
            border-radius: 10px;
            border: 2px solid var(--gray-light);
            padding: 10px;
            background: white;
            margin: 20px auto;
            display: block;
        }

        /* ==================== COMPANY INFO ==================== */
        .company-info-display {
            background: var(--white);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .company-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .company-logo-large {
            width: 100px;
            height: 100px;
            object-fit: contain;
            border-radius: 10px;
            border: 2px solid var(--gray-light);
            padding: 5px;
            background: white;
        }

        .company-details h3 {
            color: var(--primary-blue);
            font-size: 24px;
            margin-bottom: 5px;
        }

        .company-details p {
            color: var(--gray-dark);
            font-size: 14px;
        }

        /* ==================== LOADING SPINNER ==================== */
        .spinner {
            border: 3px solid var(--gray-light);
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- ==================== HTML CONTENT ==================== -->
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="brand-header">
                <img src="" alt="Company Logo" class="logo-img" id="loginLogo">
                <h1 class="company-name-display" id="loginCompanyName">XpertCopTec</h1>
                <p class="company-tagline" id="loginCompanyTagline">by RS TechnoVisions</p>
                <p class="tagline">Compliance Management Portal</p>
                
                <div class="login-form">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Username</label>
                        <input type="text" id="username" placeholder="Enter username">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-lock"></i> Password</label>
                        <input type="password" id="password" placeholder="Enter password">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-user-tag"></i> Login As</label>
                        <select id="loginRole">
                            <option value="admin">Admin</option>
                            <option value="client">Client</option>
                            <option value="unit">Unit Manager</option>
                        </select>
                    </div>
                    
                    <button class="btn-primary" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    
                    <div class="login-error" id="loginError">
                        Invalid username or password. Please try again.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <img src="" alt="Logo" class="logo-small" id="headerLogo">
                <div class="brand-info">
                    <h2 id="headerCompanyName">XpertCopTec</h2>
                    <p id="headerCompanyTagline">Compliance Portal</p>
                </div>
            </div>
            
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <span id="currentUser">Admin</span>
                        <small id="currentRole">Administrator</small>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-btn active" onclick="showPage('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-btn" onclick="showPage('compliance')">
                <i class="fas fa-file-alt"></i> Compliance
            </button>
            <button class="nav-btn" onclick="showPage('addCompliance')">
                <i class="fas fa-plus-circle"></i> Add New
            </button>
            <button class="nav-btn" onclick="showPage('reports')">
                <i class="fas fa-chart-bar"></i> Reports
            </button>
            <button class="nav-btn" onclick="showPage('subscriptions')" id="adminNav" style="display:none;">
                <i class="fas fa-credit-card"></i> Subscriptions
            </button>
            <button class="nav-btn" onclick="showPage('settings')" id="adminNav2" style="display:none;">
                <i class="fas fa-cog"></i> Settings
            </button>
            <button class="nav-btn" onclick="showPage('users')" id="adminNav3" style="display:none;">
                <i class="fas fa-users"></i> Users
            </button>
            <button class="nav-btn" onclick="openChatbot()">
                <i class="fas fa-robot"></i> AI Assistant
            </button>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Dashboard Content -->
            <div id="dashboardContent" class="content-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <div class="stat-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Total Compliances</h3>
                            <p class="stat-number" id="totalCount">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card green">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Active</h3>
                            <p class="stat-number" id="activeCount">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card orange">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Expiring Soon</h3>
                            <p class="stat-number" id="expiringCount">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card red">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Expired</h3>
                            <p class="stat-number" id="expiredCount">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="recent-section">
                    <h3><i class="fas fa-history"></i> Recent Compliances</h3>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Unit</th>
                                    <th>Type</th>
                                    <th>Valid Date</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentTable">
                                <!-- Data loads here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="showPage('addCompliance')">
                            <i class="fas fa-plus"></i> Add Compliance
                        </button>
                        <button class="action-btn" onclick="generateReport()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                        <button class="action-btn" onclick="checkReminders()">
                            <i class="fas fa-bell"></i> Check Reminders
                        </button>
                        <button class="action-btn" onclick="openChatbot()">
                            <i class="fas fa-robot"></i> AI Assistant
                        </button>
                    </div>
                </div>
            </div>

            <!-- Compliance Management -->
            <div id="complianceContent" class="content-section">
                <div class="page-header">
                    <h2><i class="fas fa-file-alt"></i> Compliance Management</h2>
                    <button class="btn-primary" onclick="showPage('addCompliance')">
                        <i class="fas fa-plus"></i> Add New
                    </button>
                </div>
                
                <div class="filters">
                    <select id="filterUnit" onchange="filterCompliance()">
                        <option value="">All Units</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Warehouse">Warehouse</option>
                        <option value="Office">Office</option>
                    </select>
                    
                    <select id="filterStatus" onchange="filterCompliance()">
                        <option value="">All Status</option>
                        <option value="Active">Active</option>
                        <option value="Expiring Soon">Expiring Soon</option>
                        <option value="Expired">Expired</option>
                    </select>
                    
                    <input type="date" id="filterDate" onchange="filterCompliance()" placeholder="Filter by date">
                    
                    <button class="btn-secondary" onclick="clearFilters()">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Unit</th>
                                <th>Compliance Type</th>
                                <th>Applied Date</th>
                                <th>Valid Date</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="complianceTable">
                            <!-- Data loads here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="table-actions">
                    <button class="btn-export" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Export to Excel
                    </button>
                    <button class="btn-secondary" onclick="loadComplianceData()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Add Compliance Form -->
            <div id="addComplianceContent" class="content-section">
                <div class="form-container">
                    <h2><i class="fas fa-plus-circle"></i> Add New Compliance</h2>
                    
                    <form id="addComplianceForm" onsubmit="event.preventDefault(); addCompliance();">
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-building"></i> Unit Name *</label>
                                <select id="unitName" required>
                                    <option value="">Select Unit</option>
                                    <option value="Manufacturing Unit 1">Manufacturing Unit 1</option>
                                    <option value="Manufacturing Unit 2">Manufacturing Unit 2</option>
                                    <option value="Warehouse A">Warehouse A</option>
                                    <option value="Warehouse B">Warehouse B</option>
                                    <option value="Head Office">Head Office</option>
                                    <option value="Branch Office">Branch Office</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-file-certificate"></i> Compliance Type *</label>
                                <input type="text" id="complianceType" placeholder="e.g., Factory License, Pollution NOC" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-calendar-plus"></i> Applied Date</label>
                                <input type="date" id="appliedDate">
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-calendar-check"></i> Valid Date *</label>
                                <input type="date" id="validDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-calendar-day"></i> Due Date *</label>
                                <input type="date" id="dueDate" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-align-left"></i> Details</label>
                            <textarea id="complianceDetails" rows="4" placeholder="Enter compliance details..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-file-upload"></i> Upload Document</label>
                            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Click to upload NOC/License copy</p>
                                <p class="file-info">Max file size: 10MB</p>
                                <input type="file" id="fileInput" hidden onchange="showFileName(this)">
                            </div>
                            <div id="fileName"></div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Save Compliance
                            </button>
                            <button type="button" class="btn-secondary" onclick="showPage('compliance')">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsContent" class="content-section">
                <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
                
                <div class="report-filters">
                    <div class="filters">
                        <select id="reportType">
                            <option value="compliance">Compliance Status</option>
                            <option value="expiry">Expiry Report</option>
                            <option value="unit">Unit-wise Report</option>
                        </select>
                        
                        <input type="date" id="reportFrom">
                        <input type="date" id="reportTo">
                        
                        <button class="btn-primary" onclick="generateReport()">
                            <i class="fas fa-chart-line"></i> Generate Report
                        </button>
                    </div>
                </div>
                
                <div class="table-container" style="margin-top: 20px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Unit</th>
                                <th>Compliance Type</th>
                                <th>Status</th>
                                <th>Valid Until</th>
                                <th>Days Left</th>
                            </tr>
                        </thead>
                        <tbody id="reportTable">
                            <!-- Report data loads here -->
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn-export" onclick="downloadExcelReport()">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <button class="btn-export" onclick="downloadPDFReport()" style="background: #ef4444;">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button class="btn-export" onclick="downloadCSVReport()" style="background: #10b981;">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                </div>
            </div>

            <!-- Subscriptions Management -->
            <div id="subscriptionsContent" class="content-section">
                <h2><i class="fas fa-credit-card"></i> Subscription Management</h2>
                
                <!-- Admin Subscription Settings -->
                <div id="adminSubscriptionSettings" style="display: none; margin-bottom: 30px;">
                    <div class="form-container">
                        <h3><i class="fas fa-cog"></i> Configure Subscription Plans</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Monthly Price (₹)</label>
                                <input type="number" id="monthlyPrice" value="999" min="0">
                            </div>
                            <div class="form-group">
                                <label>Quarterly Price (₹)</label>
                                <input type="number" id="quarterlyPrice" value="2799" min="0">
                            </div>
                            <div class="form-group">
                                <label>Yearly Price (₹)</label>
                                <input type="number" id="yearlyPrice" value="8999" min="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Free Trial Period (Days)</label>
                            <input type="number" id="freeTrialDays" value="30" min="0">
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-primary" onclick="saveSubscriptionSettings()">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Subscription Plans -->
                <div class="subscription-plans">
                    <div class="plan-card">
                        <h3>Monthly</h3>
                        <div class="plan-price">₹<span id="monthlyPriceDisplay">999</span><span>/month</span></div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Basic Compliance</li>
                            <li><i class="fas fa-check"></i> Email Reminders</li>
                            <li><i class="fas fa-check"></i> Basic Reports</li>
                        </ul>
                        <button class="btn-primary" onclick="selectPlan('monthly')">
                            <i class="fas fa-shopping-cart"></i> Subscribe
                        </button>
                    </div>
                    
                    <div class="plan-card featured">
                        <div class="plan-badge">Popular</div>
                        <h3>Quarterly</h3>
                        <div class="plan-price">₹<span id="quarterlyPriceDisplay">2,799</span><span>/3 months</span></div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> All Monthly Features</li>
                            <li><i class="fas fa-check"></i> Advanced Reports</li>
                            <li><i class="fas fa-check"></i> Priority Support</li>
                        </ul>
                        <button class="btn-primary" onclick="selectPlan('quarterly')">
                            <i class="fas fa-shopping-cart"></i> Subscribe
                        </button>
                    </div>
                    
                    <div class="plan-card">
                        <h3>Yearly</h3>
                        <div class="plan-price">₹<span id="yearlyPriceDisplay">8,999</span><span>/year</span></div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> All Features</li>
                            <li><i class="fas fa-check"></i> AI Assistant</li>
                            <li><i class="fas fa-check"></i> Custom Branding</li>
                        </ul>
                        <button class="btn-primary" onclick="selectPlan('yearly')">
                            <i class="fas fa-shopping-cart"></i> Subscribe
                        </button>
                    </div>
                </div>
                
                <!-- Free Trial Banner -->
                <div style="background: linear-gradient(135deg, #10b981, #0ea5e9); color: white; padding: 20px; border-radius: 15px; margin: 30px 0; text-align: center;">
                    <h3><i class="fas fa-gift"></i> Free Trial Available!</h3>
                    <p>Get <span id="freeTrialDaysDisplay">30</span> days free trial for all plans. No credit card required.</p>
                    <button class="btn-primary" onclick="startFreeTrial()" style="background: white; color: #10b981;">
                        <i class="fas fa-play-circle"></i> Start Free Trial
                    </button>
                </div>
                
                <div class="active-subscriptions" style="margin-top: 30px;">
                    <h3><i class="fas fa-list"></i> Active Subscriptions</h3>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Client</th>
                                    <th>Plan</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="subscriptionsTable">
                                <!-- Subscriptions load here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsContent" class="content-section">
                <div class="settings-container">
                    <h2><i class="fas fa-cog"></i> Settings</h2>
                    
                    <!-- Company Settings -->
                    <div class="settings-section">
                        <h3><i class="fas fa-building"></i> Company Information</h3>
                        
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" id="companyName" value="XpertCopTec">
                        </div>
                        
                        <div class="form-group">
                            <label>Company Tagline</label>
                            <input type="text" id="companyTagline" value="by RS TechnoVisions">
                        </div>
                        
                        <div class="form-group">
                            <label>Company Logo</label>
                            <div class="logo-upload-area" onclick="document.getElementById('companyLogoInput').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Click to upload company logo</p>
                                <p class="file-info">Recommended: 500x500px, PNG format</p>
                                <input type="file" id="companyLogoInput" hidden accept="image/*" onchange="uploadCompanyLogo(this)">
                            </div>
                            <img src="" alt="Company Logo" class="logo-preview" id="companyLogoPreview">
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-primary" onclick="saveCompanySettings()">
                                <i class="fas fa-save"></i> Save Company Settings
                            </button>
                        </div>
                    </div>
                    
                    <!-- Payment Settings -->
                    <div class="settings-section">
                        <h3><i class="fas fa-credit-card"></i> Payment Settings</h3>
                        
                        <div class="form-group">
                            <label>Bank Name</label>
                            <input type="text" id="bankName" placeholder="Enter bank name">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Account Number</label>
                                <input type="text" id="accountNumber" placeholder="Enter account number">
                            </div>
                            <div class="form-group">
                                <label>IFSC Code</label>
                                <input type="text" id="ifscCode" placeholder="Enter IFSC code">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Account Holder Name</label>
                            <input type="text" id="accountHolderName" placeholder="Enter account holder name">
                        </div>
                        
                        <div class="form-group">
                            <label>UPI ID</label>
                            <input type="text" id="upiId" placeholder="Enter UPI ID">
                        </div>
                        
                        <div class="form-group">
                            <label>QR Code</label>
                            <div class="logo-upload-area" onclick="document.getElementById('qrCodeInput').click()">
                                <i class="fas fa-qrcode"></i>
                                <p>Click to upload QR Code image</p>
                                <p class="file-info">Recommended: 500x500px, PNG format</p>
                                <input type="file" id="qrCodeInput" hidden accept="image/*" onchange="uploadQRCode(this)">
                            </div>
                            <img src="" alt="QR Code" class="logo-preview" id="qrCodePreview">
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-primary" onclick="savePaymentSettings()">
                                <i class="fas fa-save"></i> Save Payment Settings
                            </button>
                        </div>
                    </div>
                    
                    <!-- Display Company Info -->
                    <div class="company-info-display">
                        <h3><i class="fas fa-eye"></i> Preview</h3>
                        <div class="company-header">
                            <img src="" alt="Company Logo" class="company-logo-large" id="previewLogo">
                            <div class="company-details">
                                <h3 id="previewCompanyName">XpertCopTec</h3>
                                <p id="previewCompanyTagline">by RS TechnoVisions</p>
                            </div>
                        </div>
                        
                        <div class="bank-details">
                            <h4><i class="fas fa-university"></i> Bank Details</h4>
                            <p><strong>Bank:</strong> <span id="previewBankName">-</span></p>
                            <p><strong>Account Number:</strong> <span id="previewAccountNumber">-</span></p>
                            <p><strong>IFSC Code:</strong> <span id="previewIFSCCode">-</span></p>
                            <p><strong>Account Holder:</strong> <span id="previewAccountHolder">-</span></p>
                            <p><strong>UPI ID:</strong> <span id="previewUPIId">-</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management (Admin Only) -->
            <div id="usersContent" class="content-section">
                <div class="page-header">
                    <h2><i class="fas fa-users"></i> User Management</h2>
                    <button class="btn-primary" onclick="showAddUserForm()">
                        <i class="fas fa-user-plus"></i> Add User
                    </button>
                </div>
                
                <!-- Add User Form -->
                <div id="addUserForm" style="display: none; margin-bottom: 20px;">
                    <div class="form-container">
                        <h3><i class="fas fa-user-plus"></i> Add New User</h3>
                        <form onsubmit="event.preventDefault(); addUser();">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" id="userFullName" required>
                                </div>
                                <div class="form-group">
                                    <label>Username</label>
                                    <input type="text" id="userUsername" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Password</label>
                                    <input type="password" id="userPassword" required>
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="userEmail" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Role</label>
                                    <select id="userRole">
                                        <option value="admin">Admin</option>
                                        <option value="client">Client</option>
                                        <option value="unit">Unit Manager</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Assigned Unit</label>
                                    <select id="userUnit">
                                        <option value="">Select Unit</option>
                                        <option value="unit1">Unit 1</option>
                                        <option value="unit2">Unit 2</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Create User</button>
                                <button type="button" class="btn-secondary" onclick="hideAddUserForm()">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Users List -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Unit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Users load here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chatbot Modal -->
    <div id="chatbotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-robot"></i> XpertCopTec AI Assistant</h3>
                <button class="close-btn" onclick="closeChatbot()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="chatMessages">
                    <div class="bot-message">
                        <div class="message-bubble">
                            Hello! I'm your compliance assistant. How can I help you today?
                        </div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="userQuery" placeholder="Ask about compliance, licenses, reports..." 
                           onkeypress="if(event.keyCode==13) sendChatQuery()">
                    <button onclick="sendChatQuery()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-credit-card"></i> Complete Payment</h3>
                <button class="close-btn" onclick="closePaymentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="paymentPlanInfo">
                    <h4>Plan: <span id="selectedPlanName">Monthly</span></h4>
                    <p>Amount: ₹<span id="selectedPlanAmount">999</span></p>
                    <p>Duration: <span id="selectedPlanDuration">1 month</span></p>
                </div>
                
                <div class="payment-methods">
                    <div class="payment-method" onclick="selectPaymentMethod('qr')">
                        <i class="fas fa-qrcode"></i>
                        <div>
                            <h5>QR Code Payment</h5>
                            <p>Scan QR code to pay</p>
                        </div>
                    </div>
                    
                    <div class="payment-method" onclick="selectPaymentMethod('upi')">
                        <i class="fas fa-mobile-alt"></i>
                        <div>
                            <h5>UPI Payment</h5>
                            <p>Pay via UPI ID</p>
                        </div>
                    </div>
                    
                    <div class="payment-method" onclick="selectPaymentMethod('bank')">
                        <i class="fas fa-university"></i>
                        <div>
                            <h5>Bank Transfer</h5>
                            <p>Direct bank transfer</p>
                        </div>
                    </div>
                </div>
                
                <!-- QR Code Payment -->
                <div id="qrPaymentSection" style="display: none;">
                    <div class="qr-code-container">
                        <div class="qr-code-placeholder" id="qrCodeDisplay">
                            <div>QR Code will appear here</div>
                        </div>
                        <p>Scan this QR code with any UPI app to pay</p>
                        <button class="btn-primary" onclick="simulatePayment()">
                            <i class="fas fa-check-circle"></i> I Have Paid
                        </button>
                    </div>
                </div>
                
                <!-- UPI Payment -->
                <div id="upiPaymentSection" style="display: none;">
                    <div class="bank-details">
                        <h4>UPI Payment Details</h4>
                        <p><strong>UPI ID:</strong> <span id="displayUPIId">-</span></p>
                        <p>Use this UPI ID to make payment from any UPI app</p>
                        <button class="btn-primary" onclick="copyUPIId()">
                            <i class="fas fa-copy"></i> Copy UPI ID
                        </button>
                        <button class="btn-secondary" onclick="simulatePayment()" style="margin-left: 10px;">
                            <i class="fas fa-check-circle"></i> I Have Paid
                        </button>
                    </div>
                </div>
                
                <!-- Bank Transfer -->
                <div id="bankPaymentSection" style="display: none;">
                    <div class="bank-details">
                        <h4>Bank Transfer Details</h4>
                        <p><strong>Bank Name:</strong> <span id="displayBankName">-</span></p>
                        <p><strong>Account Number:</strong> <span id="displayAccountNumber">-</span></p>
                        <p><strong>IFSC Code:</strong> <span id="displayIFSCCode">-</span></p>
                        <p><strong>Account Holder:</strong> <span id="displayAccountHolder">-</span></p>
                        <button class="btn-primary" onclick="copyBankDetails()">
                            <i class="fas fa-copy"></i> Copy Bank Details
                        </button>
                        <button class="btn-secondary" onclick="simulatePayment()" style="margin-left: 10px;">
                            <i class="fas fa-check-circle"></i> I Have Paid
                        </button>
                    </div>
                </div>
                
                <div id="paymentStatus" style="margin-top: 20px; display: none;">
                    <div class="alert success">
                        <i class="fas fa-check-circle"></i> Payment Successful! Subscription activated.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let currentRole = null;
        let complianceData = [];
        let usersData = [];
        let subscriptionsData = [];
        let companySettings = {};
        let paymentSettings = {};
        let subscriptionSettings = {};
        let selectedPlan = null;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize default settings
            initializeDefaultSettings();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('xpertcoptec_user');
            const savedRole = localStorage.getItem('xpertcoptec_role');
            
            if (savedUser && savedRole) {
                currentUser = savedUser;
                currentRole = savedRole;
                showDashboard();
                initializeData();
            } else {
                showLogin();
            }
            
            // Set default dates in forms
            setDefaultDates();
            
            // Load company settings for login page
            loadCompanySettings();
        });

        // ==================== DEFAULT SETTINGS ====================
        function initializeDefaultSettings() {
            // Load company settings
            const savedCompany = localStorage.getItem('xpertcoptec_company');
            if (savedCompany) {
                companySettings = JSON.parse(savedCompany);
            } else {
                companySettings = {
                    name: "XpertCopTec",
                    tagline: "by RS TechnoVisions",
                    logo: ""
                };
                localStorage.setItem('xpertcoptec_company', JSON.stringify(companySettings));
            }
            
            // Load payment settings
            const savedPayment = localStorage.getItem('xpertcoptec_payment');
            if (savedPayment) {
                paymentSettings = JSON.parse(savedPayment);
            } else {
                paymentSettings = {
                    bankName: "",
                    accountNumber: "",
                    ifscCode: "",
                    accountHolderName: "",
                    upiId: "",
                    qrCode: ""
                };
                localStorage.setItem('xpertcoptec_payment', JSON.stringify(paymentSettings));
            }
            
            // Load subscription settings
            const savedSubscription = localStorage.getItem('xpertcoptec_subscription_settings');
            if (savedSubscription) {
                subscriptionSettings = JSON.parse(savedSubscription);
            } else {
                subscriptionSettings = {
                    monthlyPrice: 999,
                    quarterlyPrice: 2799,
                    yearlyPrice: 8999,
                    freeTrialDays: 30
                };
                localStorage.setItem('xpertcoptec_subscription_settings', JSON.stringify(subscriptionSettings));
            }
            
            // Load users data
            const savedUsers = localStorage.getItem('xpertcoptec_users');
            if (savedUsers) {
                usersData = JSON.parse(savedUsers);
            } else {
                // Create default admin user
                usersData = [
                    {
                        id: 1,
                        username: 'admin',
                        password: 'admin123', // In real app, hash this
                        fullName: 'Administrator',
                        email: 'admin@xpertcoptec.com',
                        role: 'admin',
                        unit: 'All',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        username: 'client',
                        password: 'client123',
                        fullName: 'Demo Client',
                        email: 'client@example.com',
                        role: 'client',
                        unit: 'Unit 1',
                        createdAt: new Date().toISOString()
                    }
                ];
                saveUsersData();
            }
            
            // Load compliance data
            const savedCompliance = localStorage.getItem('xpertcoptec_compliance');
            if (savedCompliance) {
                complianceData = JSON.parse(savedCompliance);
            } else {
                initializeSampleComplianceData();
            }
            
            // Load subscriptions data
            const savedSubscriptions = localStorage.getItem('xpertcoptec_subscriptions_data');
            if (savedSubscriptions) {
                subscriptionsData = JSON.parse(savedSubscriptions);
            }
        }

        function initializeSampleComplianceData() {
            const today = new Date().toISOString().split('T')[0];
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            const nextMonthStr = nextMonth.toISOString().split('T')[0];
            
            const nextYear = new Date();
            nextYear.setFullYear(nextYear.getFullYear() + 1);
            const nextYearStr = nextYear.toISOString().split('T')[0];
            
            complianceData = [
                {
                    id: 1,
                    unit: 'Manufacturing Unit 1',
                    type: 'Factory License',
                    appliedDate: '2024-01-15',
                    validDate: nextYearStr,
                    dueDate: nextMonthStr,
                    details: 'Main manufacturing plant license',
                    status: 'Active',
                    document: null,
                    companyId: 1,
                    createdBy: 1,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    unit: 'Warehouse A',
                    type: 'Fire Safety Certificate',
                    appliedDate: '2024-02-01',
                    validDate: nextYearStr,
                    dueDate: nextMonthStr,
                    details: 'Fire safety compliance for warehouse',
                    status: 'Active',
                    document: null,
                    companyId: 1,
                    createdBy: 1,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    unit: 'Head Office',
                    type: 'GST Registration',
                    appliedDate: '2024-01-01',
                    validDate: nextYearStr,
                    dueDate: nextMonthStr,
                    details: 'GST registration certificate',
                    status: 'Active',
                    document: null,
                    companyId: 1,
                    createdBy: 1,
                    createdAt: new Date().toISOString()
                }
            ];
            saveComplianceData();
        }

        // ==================== LOAD COMPANY SETTINGS ====================
        function loadCompanySettings() {
            // Update login page
            document.getElementById('loginCompanyName').textContent = companySettings.name;
            document.getElementById('loginCompanyTagline').textContent = companySettings.tagline;
            
            if (companySettings.logo) {
                document.getElementById('loginLogo').src = companySettings.logo;
            }
            
            // Update preview
            document.getElementById('previewCompanyName').textContent = companySettings.name;
            document.getElementById('previewCompanyTagline').textContent = companySettings.tagline;
            document.getElementById('companyName').value = companySettings.name;
            document.getElementById('companyTagline').value = companySettings.tagline;
            
            if (companySettings.logo) {
                document.getElementById('companyLogoPreview').src = companySettings.logo;
                document.getElementById('previewLogo').src = companySettings.logo;
            }
            
            // Update payment settings
            document.getElementById('bankName').value = paymentSettings.bankName || '';
            document.getElementById('accountNumber').value = paymentSettings.accountNumber || '';
            document.getElementById('ifscCode').value = paymentSettings.ifscCode || '';
            document.getElementById('accountHolderName').value = paymentSettings.accountHolderName || '';
            document.getElementById('upiId').value = paymentSettings.upiId || '';
            
            document.getElementById('previewBankName').textContent = paymentSettings.bankName || '-';
            document.getElementById('previewAccountNumber').textContent = paymentSettings.accountNumber || '-';
            document.getElementById('previewIFSCCode').textContent = paymentSettings.ifscCode || '-';
            document.getElementById('previewAccountHolder').textContent = paymentSettings.accountHolderName || '-';
            document.getElementById('previewUPIId').textContent = paymentSettings.upiId || '-';
            
            if (paymentSettings.qrCode) {
                document.getElementById('qrCodePreview').src = paymentSettings.qrCode;
            }
            
            // Update subscription settings
            document.getElementById('monthlyPrice').value = subscriptionSettings.monthlyPrice;
            document.getElementById('quarterlyPrice').value = subscriptionSettings.quarterlyPrice;
            document.getElementById('yearlyPrice').value = subscriptionSettings.yearlyPrice;
            document.getElementById('freeTrialDays').value = subscriptionSettings.freeTrialDays;
            
            document.getElementById('monthlyPriceDisplay').textContent = subscriptionSettings.monthlyPrice.toLocaleString();
            document.getElementById('quarterlyPriceDisplay').textContent = subscriptionSettings.quarterlyPrice.toLocaleString();
            document.getElementById('yearlyPriceDisplay').textContent = subscriptionSettings.yearlyPrice.toLocaleString();
            document.getElementById('freeTrialDaysDisplay').textContent = subscriptionSettings.freeTrialDays;
        }

        // ==================== LOGIN/LOGOUT ====================
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('loginRole').value;
            
            // Simple validation
            if (!username || !password) {
                showAlert('error', 'Please enter username and password');
                document.getElementById('loginError').style.display = 'block';
                return;
            }
            
            // Find user in usersData
            const user = usersData.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = username;
                currentRole = user.role;
                
                // Save to localStorage
                localStorage.setItem('xpertcoptec_user', username);
                localStorage.setItem('xpertcoptec_role', user.role);
                
                showAlert('success', 'Login successful!');
                document.getElementById('loginError').style.display = 'none';
                
                setTimeout(() => {
                    showDashboard();
                    initializeData();
                }, 1000);
            } else {
                showAlert('error', 'Invalid username or password');
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('xpertcoptec_user');
                localStorage.removeItem('xpertcoptec_role');
                currentUser = null;
                currentRole = null;
                showLogin();
                showAlert('info', 'Logged out successfully');
            }
        }

        // ==================== PAGE NAVIGATION ====================
        function showLogin() {
            document.getElementById('loginPage').classList.add('active');
            document.getElementById('dashboardPage').classList.remove('active');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('loginPage').classList.remove('active');
            document.getElementById('dashboardPage').classList.add('active');
            
            // Update user info
            document.getElementById('currentUser').textContent = currentUser;
            document.getElementById('currentRole').textContent = 
                currentRole === 'admin' ? 'Administrator' : 
                currentRole === 'client' ? 'Client' : 'Unit Manager';
            
            // Update header with company settings
            document.getElementById('headerCompanyName').textContent = companySettings.name;
            document.getElementById('headerCompanyTagline').textContent = companySettings.tagline;
            if (companySettings.logo) {
                document.getElementById('headerLogo').src = companySettings.logo;
            }
            
            // Show/hide admin features
            const adminNavs = document.querySelectorAll('#adminNav, #adminNav2, #adminNav3');
            adminNavs.forEach(nav => {
                nav.style.display = currentRole === 'admin' ? 'flex' : 'none';
            });
            
            // Show admin subscription settings if admin
            document.getElementById('adminSubscriptionSettings').style.display = 
                currentRole === 'admin' ? 'block' : 'none';
            
            // Show dashboard by default
            showPage('dashboard');
        }

        function showPage(pageId) {
            // Hide all content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Deactivate all nav buttons
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId + 'Content').classList.add('active');
            
            // Activate corresponding nav button
            const navBtn = document.querySelector(`.nav-btn[onclick*="'${pageId}'"]`);
            if (navBtn) navBtn.classList.add('active');
            
            // Load data for the page
            switch(pageId) {
                case 'dashboard':
                    updateDashboardStats();
                    loadRecentCompliance();
                    break;
                case 'compliance':
                    loadComplianceData();
                    break;
                case 'reports':
                    loadReportsData();
                    break;
                case 'subscriptions':
                    loadSubscriptionsData();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
                case 'users':
                    if (currentRole === 'admin') loadUsersData();
                    break;
            }
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        function updateDashboardStats() {
            if (complianceData.length === 0) return;
            
            const today = new Date();
            const thirtyDaysFromNow = new Date();
            thirtyDaysFromNow.setDate(today.getDate() + 30);
            
            let active = 0;
            let expiring = 0;
            let expired = 0;
            
            complianceData.forEach(item => {
                const validDate = new Date(item.validDate);
                
                if (validDate < today) {
                    expired++;
                } else if (validDate <= thirtyDaysFromNow) {
                    expiring++;
                } else {
                    active++;
                }
            });
            
            document.getElementById('totalCount').textContent = complianceData.length;
            document.getElementById('activeCount').textContent = active;
            document.getElementById('expiringCount').textContent = expiring;
            document.getElementById('expiredCount').textContent = expired;
        }

        function loadRecentCompliance() {
            const recentData = complianceData.slice(0, 5);
            const tableBody = document.getElementById('recentTable');
            
            let html = '';
            recentData.forEach(item => {
                const statusClass = getStatusClass(item.validDate);
                const statusText = getStatusText(item.validDate);
                
                html += `
                    <tr>
                        <td>${item.unit}</td>
                        <td>${item.type}</td>
                        <td>${formatDate(item.validDate)}</td>
                        <td>${formatDate(item.dueDate)}</td>
                        <td><span class="status-${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // ==================== COMPLIANCE MANAGEMENT ====================
        function loadComplianceData() {
            const tableBody = document.getElementById('complianceTable');
            
            let html = '';
            complianceData.forEach((item, index) => {
                const statusClass = getStatusClass(item.validDate);
                const statusText = getStatusText(item.validDate);
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.unit}</td>
                        <td>${item.type}</td>
                        <td>${formatDate(item.appliedDate)}</td>
                        <td>${formatDate(item.validDate)}</td>
                        <td>${formatDate(item.dueDate)}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn-small" onclick="editCompliance(${index})" style="padding: 5px 10px; margin: 2px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-small" onclick="deleteCompliance(${index})" style="padding: 5px 10px; margin: 2px; background: #ef4444; color: white;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function addCompliance() {
            const unit = document.getElementById('unitName').value;
            const type = document.getElementById('complianceType').value;
            const applied = document.getElementById('appliedDate').value;
            const valid = document.getElementById('validDate').value;
            const due = document.getElementById('dueDate').value;
            const details = document.getElementById('complianceDetails').value;
            const fileInput = document.getElementById('fileInput');
            
            if (!unit || !type || !valid || !due) {
                showAlert('error', 'Please fill all required fields');
                return;
            }
            
            // Create new compliance object
            const newCompliance = {
                id: complianceData.length + 1,
                unit: unit,
                type: type,
                appliedDate: applied || new Date().toISOString().split('T')[0],
                validDate: valid,
                dueDate: due,
                details: details,
                status: getStatusText(valid),
                document: fileInput.files[0] ? fileInput.files[0].name : null,
                companyId: 1,
                createdBy: 1,
                createdAt: new Date().toISOString()
            };
            
            complianceData.unshift(newCompliance);
            saveComplianceData();
            
            // Reset form
            document.getElementById('addComplianceForm').reset();
            document.getElementById('fileName').textContent = '';
            setDefaultDates();
            
            showAlert('success', 'Compliance added successfully!');
            
            // Update dashboard
            updateDashboardStats();
            
            // Return to compliance list
            setTimeout(() => {
                showPage('compliance');
            }, 1500);
        }

        // ==================== REPORTS ====================
        function downloadExcelReport() {
            showAlert('info', 'Generating Excel report...');
            
            // Create Excel content
            let csvContent = "Unit,Compliance Type,Status,Valid Until,Days Left\n";
            complianceData.forEach(item => {
                const daysLeft = getDaysLeft(item.validDate);
                const statusText = getStatusText(item.validDate);
                csvContent += `${item.unit},${item.type},${statusText},${item.validDate},${daysLeft}\n`;
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `compliance_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showAlert('success', 'Excel report downloaded!');
        }

        function downloadPDFReport() {
            showAlert('info', 'Generating PDF report...');
            
            // Create PDF content
            let pdfContent = `
                <html>
                <head>
                    <title>Compliance Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        h1 { color: #2563eb; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th { background: #f8fafc; padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0; }
                        td { padding: 10px; border-bottom: 1px solid #e2e8f0; }
                        .status-active { color: #10b981; }
                        .status-warning { color: #f59e0b; }
                        .status-expired { color: #ef4444; }
                    </style>
                </head>
                <body>
                    <h1>Compliance Report - ${companySettings.name}</h1>
                    <p>Generated on: ${new Date().toLocaleDateString()}</p>
                    <table>
                        <tr>
                            <th>Unit</th>
                            <th>Compliance Type</th>
                            <th>Status</th>
                            <th>Valid Until</th>
                            <th>Days Left</th>
                        </tr>
            `;
            
            complianceData.forEach(item => {
                const daysLeft = getDaysLeft(item.validDate);
                const statusClass = getStatusClass(item.validDate);
                const statusText = getStatusText(item.validDate);
                
                pdfContent += `
                    <tr>
                        <td>${item.unit}</td>
                        <td>${item.type}</td>
                        <td class="status-${statusClass}">${statusText}</td>
                        <td>${formatDate(item.validDate)}</td>
                        <td>${daysLeft > 0 ? daysLeft + ' days' : 'Expired'}</td>
                    </tr>
                `;
            });
            
            pdfContent += `
                    </table>
                </body>
                </html>
            `;
            
            // Open in new window for printing/saving as PDF
            const newWindow = window.open();
            newWindow.document.write(pdfContent);
            newWindow.document.close();
            
            showAlert('success', 'PDF report generated! You can print/save it as PDF.');
        }

        function downloadCSVReport() {
            downloadExcelReport(); // Same as Excel for now
        }

        // ==================== SUBSCRIPTIONS ====================
        function saveSubscriptionSettings() {
            const monthlyPrice = parseFloat(document.getElementById('monthlyPrice').value) || 999;
            const quarterlyPrice = parseFloat(document.getElementById('quarterlyPrice').value) || 2799;
            const yearlyPrice = parseFloat(document.getElementById('yearlyPrice').value) || 8999;
            const freeTrialDays = parseInt(document.getElementById('freeTrialDays').value) || 30;
            
            subscriptionSettings = {
                monthlyPrice: monthlyPrice,
                quarterlyPrice: quarterlyPrice,
                yearlyPrice: yearlyPrice,
                freeTrialDays: freeTrialDays
            };
            
            localStorage.setItem('xpertcoptec_subscription_settings', JSON.stringify(subscriptionSettings));
            
            // Update display
            document.getElementById('monthlyPriceDisplay').textContent = monthlyPrice.toLocaleString();
            document.getElementById('quarterlyPriceDisplay').textContent = quarterlyPrice.toLocaleString();
            document.getElementById('yearlyPriceDisplay').textContent = yearlyPrice.toLocaleString();
            document.getElementById('freeTrialDaysDisplay').textContent = freeTrialDays;
            
            showAlert('success', 'Subscription settings saved!');
        }

        function selectPlan(planType) {
            selectedPlan = planType;
            
            // Update payment modal
            let planName = '';
            let planAmount = 0;
            let planDuration = '';
            
            switch(planType) {
                case 'monthly':
                    planName = 'Monthly Plan';
                    planAmount = subscriptionSettings.monthlyPrice;
                    planDuration = '1 month';
                    break;
                case 'quarterly':
                    planName = 'Quarterly Plan';
                    planAmount = subscriptionSettings.quarterlyPrice;
                    planDuration = '3 months';
                    break;
                case 'yearly':
                    planName = 'Yearly Plan';
                    planAmount = subscriptionSettings.yearlyPrice;
                    planDuration = '1 year';
                    break;
            }
            
            document.getElementById('selectedPlanName').textContent = planName;
            document.getElementById('selectedPlanAmount').textContent = planAmount.toLocaleString();
            document.getElementById('selectedPlanDuration').textContent = planDuration;
            
            // Show payment modal
            document.getElementById('paymentModal').classList.add('active');
            
            // Reset payment sections
            document.getElementById('qrPaymentSection').style.display = 'none';
            document.getElementById('upiPaymentSection').style.display = 'none';
            document.getElementById('bankPaymentSection').style.display = 'none';
            document.getElementById('paymentStatus').style.display = 'none';
            
            // Reset payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.classList.remove('selected');
            });
        }

        function startFreeTrial() {
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + subscriptionSettings.freeTrialDays);
            
            const newSubscription = {
                id: subscriptionsData.length + 1,
                client: currentUser,
                plan: 'Free Trial',
                amount: 0,
                startDate: new Date().toISOString().split('T')[0],
                endDate: endDate.toISOString().split('T')[0],
                status: 'Active',
                paymentMethod: 'Free Trial',
                transactionId: 'FREE_TRIAL_' + Date.now()
            };
            
            subscriptionsData.push(newSubscription);
            localStorage.setItem('xpertcoptec_subscriptions_data', JSON.stringify(subscriptionsData));
            
            showAlert('success', `Free trial started for ${subscriptionSettings.freeTrialDays} days!`);
            loadSubscriptionsData();
        }

        function selectPaymentMethod(method) {
            // Update UI
            document.querySelectorAll('.payment-method').forEach(m => {
                m.classList.remove('selected');
            });
            event.target.closest('.payment-method').classList.add('selected');
            
            // Show selected payment section
            document.getElementById('qrPaymentSection').style.display = 'none';
            document.getElementById('upiPaymentSection').style.display = 'none';
            document.getElementById('bankPaymentSection').style.display = 'none';
            
            switch(method) {
                case 'qr':
                    document.getElementById('qrPaymentSection').style.display = 'block';
                    if (paymentSettings.qrCode) {
                        document.getElementById('qrCodeDisplay').innerHTML = 
                            `<img src="${paymentSettings.qrCode}" alt="QR Code" style="width:100%;height:100%;object-fit:contain;">`;
                    }
                    break;
                case 'upi':
                    document.getElementById('upiPaymentSection').style.display = 'block';
                    document.getElementById('displayUPIId').textContent = paymentSettings.upiId || 'Not set';
                    break;
                case 'bank':
                    document.getElementById('bankPaymentSection').style.display = 'block';
                    document.getElementById('displayBankName').textContent = paymentSettings.bankName || 'Not set';
                    document.getElementById('displayAccountNumber').textContent = paymentSettings.accountNumber || 'Not set';
                    document.getElementById('displayIFSCCode').textContent = paymentSettings.ifscCode || 'Not set';
                    document.getElementById('displayAccountHolder').textContent = paymentSettings.accountHolderName || 'Not set';
                    break;
            }
        }

        function simulatePayment() {
            // Simulate payment processing
            showAlert('info', 'Processing payment...');
            
            setTimeout(() => {
                const planName = document.getElementById('selectedPlanName').textContent;
                const planAmount = document.getElementById('selectedPlanAmount').textContent;
                
                const endDate = new Date();
                switch(selectedPlan) {
                    case 'monthly':
                        endDate.setMonth(endDate.getMonth() + 1);
                        break;
                    case 'quarterly':
                        endDate.setMonth(endDate.getMonth() + 3);
                        break;
                    case 'yearly':
                        endDate.setFullYear(endDate.getFullYear() + 1);
                        break;
                }
                
                const newSubscription = {
                    id: subscriptionsData.length + 1,
                    client: currentUser,
                    plan: planName,
                    amount: parseFloat(planAmount.replace(/,/g, '')),
                    startDate: new Date().toISOString().split('T')[0],
                    endDate: endDate.toISOString().split('T')[0],
                    status: 'Active',
                    paymentMethod: 'Online Payment',
                    transactionId: 'TXN_' + Date.now()
                };
                
                subscriptionsData.push(newSubscription);
                localStorage.setItem('xpertcoptec_subscriptions_data', JSON.stringify(subscriptionsData));
                
                document.getElementById('paymentStatus').style.display = 'block';
                showAlert('success', 'Payment successful! Subscription activated.');
                
                setTimeout(() => {
                    closePaymentModal();
                    loadSubscriptionsData();
                }, 2000);
            }, 1500);
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            selectedPlan = null;
        }

        function loadSubscriptionsData() {
            const tableBody = document.getElementById('subscriptionsTable');
            
            let html = '';
            subscriptionsData.forEach((sub, index) => {
                html += `
                    <tr>
                        <td>${sub.client}</td>
                        <td>${sub.plan}</td>
                        <td>${formatDate(sub.startDate)}</td>
                        <td>${formatDate(sub.endDate)}</td>
                        <td><span class="status-active">${sub.status}</span></td>
                        <td>
                            <button class="btn-small" onclick="renewSubscription(${index})" style="padding: 5px 10px; margin: 2px;">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn-small" onclick="cancelSubscription(${index})" style="padding: 5px 10px; margin: 2px; background: #ef4444; color: white;">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // ==================== SETTINGS ====================
        function saveCompanySettings() {
            const name = document.getElementById('companyName').value;
            const tagline = document.getElementById('companyTagline').value;
            
            companySettings.name = name;
            companySettings.tagline = tagline;
            
            localStorage.setItem('xpertcoptec_company', JSON.stringify(companySettings));
            
            // Update all displays
            loadCompanySettings();
            showAlert('success', 'Company settings saved!');
        }

        function savePaymentSettings() {
            paymentSettings.bankName = document.getElementById('bankName').value;
            paymentSettings.accountNumber = document.getElementById('accountNumber').value;
            paymentSettings.ifscCode = document.getElementById('ifscCode').value;
            paymentSettings.accountHolderName = document.getElementById('accountHolderName').value;
            paymentSettings.upiId = document.getElementById('upiId').value;
            
            localStorage.setItem('xpertcoptec_payment', JSON.stringify(paymentSettings));
            
            loadCompanySettings();
            showAlert('success', 'Payment settings saved!');
        }

        function uploadCompanyLogo(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    companySettings.logo = e.target.result;
                    localStorage.setItem('xpertcoptec_company', JSON.stringify(companySettings));
                    
                    document.getElementById('companyLogoPreview').src = e.target.result;
                    document.getElementById('previewLogo').src = e.target.result;
                    
                    showAlert('success', 'Company logo uploaded!');
                };
                reader.readAsDataURL(file);
            }
        }

        function uploadQRCode(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    paymentSettings.qrCode = e.target.result;
                    localStorage.setItem('xpertcoptec_payment', JSON.stringify(paymentSettings));
                    
                    document.getElementById('qrCodePreview').src = e.target.result;
                    showAlert('success', 'QR Code uploaded!');
                };
                reader.readAsDataURL(file);
            }
        }

        // ==================== HELPER FUNCTIONS ====================
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const nextYear = new Date();
            nextYear.setFullYear(nextYear.getFullYear() + 1);
            const nextYearStr = nextYear.toISOString().split('T')[0];
            
            const appliedDate = document.getElementById('appliedDate');
            const validDate = document.getElementById('validDate');
            const dueDate = document.getElementById('dueDate');
            
            if (appliedDate && !appliedDate.value) {
                appliedDate.value = today;
            }
            if (validDate && !validDate.value) {
                validDate.value = nextYearStr;
            }
            if (dueDate && !dueDate.value) {
                const due = new Date(nextYearStr);
                due.setMonth(due.getMonth() - 1);
                dueDate.value = due.toISOString().split('T')[0];
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        function getDaysLeft(dateString) {
            const today = new Date();
            const date = new Date(dateString);
            const diffTime = date - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function getStatusClass(dateString) {
            const daysLeft = getDaysLeft(dateString);
            if (daysLeft < 0) return 'expired';
            if (daysLeft <= 30) return 'warning';
            return 'active';
        }

        function getStatusText(dateString) {
            const daysLeft = getDaysLeft(dateString);
            if (daysLeft < 0) return 'Expired';
            if (daysLeft <= 30) return 'Expiring Soon';
            return 'Active';
        }

        // ==================== DATA PERSISTENCE ====================
        function saveComplianceData() {
            localStorage.setItem('xpertcoptec_compliance', JSON.stringify(complianceData));
        }

        function saveUsersData() {
            localStorage.setItem('xpertcoptec_users', JSON.stringify(usersData));
        }

        // ==================== ALERTS ====================
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.innerHTML = `
                ${message}
                <button onclick="this.parentElement.remove()" style="background:none; border:none; color:white; cursor:pointer; margin-left:10px;">
                    &times;
                </button>
            `;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 5000);
        }

        // ==================== AI CHATBOT ====================
        function openChatbot() {
            document.getElementById('chatbotModal').classList.add('active');
            document.getElementById('userQuery').focus();
        }

        function closeChatbot() {
            document.getElementById('chatbotModal').classList.remove('active');
        }

        function sendChatQuery() {
            const query = document.getElementById('userQuery').value.trim();
            if (!query) return;
            
            addChatMessage('user', query);
            document.getElementById('userQuery').value = '';
            
            addChatMessage('bot', '...', true);
            
            setTimeout(() => {
                const messages = document.getElementById('chatMessages');
                messages.removeChild(messages.lastChild);
                
                const response = getAIResponse(query);
                addChatMessage('bot', response);
            }, 1000);
        }

        function addChatMessage(sender, message, isTyping = false) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender + '-message';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            
            if (isTyping) {
                bubble.innerHTML = '<i class="fas fa-ellipsis-h"></i>';
            } else {
                bubble.textContent = message;
            }
            
            messageDiv.appendChild(bubble);
            messagesDiv.appendChild(messageDiv);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getAIResponse(query) {
            const q = query.toLowerCase();
            
            if (q.includes('license') || q.includes('noc')) {
                return 'You can add licenses in the Compliance section. Make sure to upload the document and set valid dates.';
            } else if (q.includes('expir') || q.includes('due')) {
                const expiring = complianceData.filter(item => getStatusText(item.validDate) === 'Expiring Soon');
                return `You have ${expiring.length} compliances expiring soon. Check the Dashboard for details.`;
            } else if (q.includes('report')) {
                return 'Go to Reports section to generate compliance reports. You can export to Excel, PDF, or CSV.';
            } else if (q.includes('add') || q.includes('new')) {
                return 'Click "Add New" in the navigation to add new compliance records. Don\'t forget to set all dates!';
            } else if (q.includes('admin')) {
                return 'Admin features include user management and subscription handling. Only admins can access these.';
            } else if (q.includes('subscription') || q.includes('payment')) {
                return 'Go to Subscriptions section to choose a plan. We offer Monthly, Quarterly, and Yearly plans with free trial.';
            } else if (q.includes('hello') || q.includes('hi')) {
                return 'Hello! I\'m your compliance assistant. How can I help you today?';
            } else if (q.includes('thank')) {
                return 'You\'re welcome! Let me know if you need anything else.';
            } else {
                return 'I can help you with compliance management, license tracking, report generation, and reminders. What would you like to know?';
            }
        }

        // ==================== INITIALIZE DATA ====================
        function initializeData() {
            updateDashboardStats();
            loadRecentCompliance();
            loadCompanySettings();
        }
    </script>
</body>
</html>
